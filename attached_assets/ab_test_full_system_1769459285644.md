# A/B –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –ø–æ —Ü–µ–Ω–µ

## üìå –¶–µ–ª—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–ó–∞–¥–∞—á–∞**: –ü—Ä–æ–≤–µ—Å—Ç–∏ A/B —Ç–µ—Å—Ç—ã –Ω–∞ —Å–∞–π—Ç–µ, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

**–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç—ã –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –∞–¥–º–∏–Ω–∫–∏ (JSON –∫–æ–Ω—Ñ–∏–≥–∏)
- –§—Ä–æ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–º–Ω–æ–∂–∞–µ—Ç —Ü–µ–Ω—É –Ω–∞ `price_multy`)
- **–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç** (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ, –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ)
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø–µ**
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç
  ‚Üì
–ü–æ–ª—É—á–∞–µ–º/—Å–æ–∑–¥–∞—ë–º identifier (userId –∏–ª–∏ deviceId)
  ‚Üì
–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ —Ç–µ—Å—Ç–æ–≤ –∏–∑ –∞–¥–º–∏–Ω–∫–∏
  ‚Üì
–í—ã—á–∏—Å–ª—è–µ–º –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∏–¥–∏—Ç —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  ‚Üì
–ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—É–º–Ω–æ–∂–∞–µ–º —Ü–µ–Ω—É –Ω–∞ price_multy)
  ‚Üì
–õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è (–ø—Ä–æ—Å–º–æ—Ç—Ä, –∫–ª–∏–∫, –∑–∞–∫–∞–∑) —Å info –æ –≤–∞—Ä–∏–∞–Ω—Ç–µ
  ‚Üì
–î–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –≤ DWH –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
```

---

## üéØ –®–∞–≥ 1: –í–∫–ª–∞–¥–∫–∞ "–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã" –≤ –∞–¥–º–∏–Ω–∫–µ

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:
1. –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ: **"–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã"**
2. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
3. –ü–æ–∏—Å–∫ –ø–æ `test_id` –∏ `name`
4. –ö–Ω–æ–ø–∫–∏: "–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
5. JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥–∞ —Ç–µ—Å—Ç–∞:

```json
{
  "test_id": "price_jan_2026_v1",
  "name": "–¢–µ—Å—Ç —Ü–µ–Ω—ã –Ø–Ω–≤–∞—Ä—å 2026 V1",
  "description": "–ü—Ä–æ–≤–µ—Ä—è–µ–º —É–ø–∞–¥—ë—Ç –ª–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—è –ø—Ä–∏ —Ü–µ–Ω–µ -50%",
  "status": "active",
  "created_at": "2026-01-26T11:00:00Z",
  "updated_at": "2026-01-26T11:00:00Z",
  "variants": [
    {
      "id": "control",
      "name": "–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞)",
      "weight": 50,
      "config": {
        "price_multy": 1.0
      }
    },
    {
      "id": "experiment",
      "name": "–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ (—Ü–µ–Ω–∞ -50%)",
      "weight": 50,
      "config": {
        "price_multy": 0.5
      }
    }
  ]
}
```

### –ü–æ–ª—è:
- `test_id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ—Å—Ç–∞ (kebab-case, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
- `name` ‚Äî –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
- `description` ‚Äî –∑–∞—á–µ–º —ç—Ç–æ—Ç —Ç–µ—Å—Ç, —á—Ç–æ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º
- `status` ‚Äî "active" –∏–ª–∏ "inactive"
- `created_at`, `updated_at` ‚Äî –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- `variants` ‚Äî –º–∞—Å—Å–∏–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (2, 3, 4+ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

### –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–∫–∏:

**1. –ü—Ä–æ—Å—Ç–æ–π 50/50 —Ç–µ—Å—Ç —Ü–µ–Ω—ã:**
```json
{
  "test_id": "price_50_50",
  "name": "50/50 —Ç–µ—Å—Ç —Ü–µ–Ω—ã",
  "description": "–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç",
  "status": "active",
  "variants": [
    { "id": "control", "name": "–¶–µ–Ω–∞ √ó1", "weight": 50, "config": { "price_multy": 1.0 } },
    { "id": "cheap", "name": "–¶–µ–Ω–∞ √ó0.5", "weight": 50, "config": { "price_multy": 0.5 } }
  ]
}
```

**2. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã–∫–∞—Ç (80/20):**
```json
{
  "test_id": "price_rollout_week1",
  "name": "–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã–∫–∞—Ç —Ü–µ–Ω—ã (–Ω–µ–¥–µ–ª—è 1)",
  "description": "20% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–∏–¥—è—Ç –Ω–æ–≤—É—é —Ü–µ–Ω—É",
  "status": "active",
  "variants": [
    { "id": "control", "name": "–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞", "weight": 80, "config": { "price_multy": 1.0 } },
    { "id": "new_price", "name": "–ù–æ–≤–∞—è —Ü–µ–Ω–∞ -50%", "weight": 20, "config": { "price_multy": 0.5 } }
  ]
}
```

**3. –¢—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (33/33/34):**
```json
{
  "test_id": "price_three_variants",
  "name": "–¢—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ü–µ–Ω—ã",
  "description": "–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∞—è —Ü–µ–Ω–∞ –ª—É—á—à–µ: -30%, -50% –∏–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è",
  "status": "active",
  "variants": [
    { "id": "control", "name": "–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞", "weight": 33, "config": { "price_multy": 1.0 } },
    { "id": "discount_30", "name": "–°–∫–∏–¥–∫–∞ 30%", "weight": 33, "config": { "price_multy": 0.7 } },
    { "id": "discount_50", "name": "–°–∫–∏–¥–∫–∞ 50%", "weight": 34, "config": { "price_multy": 0.5 } }
  ]
}
```

---

## üéØ –®–∞–≥ 2: –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è identifier (userId –∏–ª–∏ deviceId)

### –ì–¥–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
–§—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ, –¥–æ –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

### –ê–ª–≥–æ—Ä–∏—Ç–º:

```javascript
/**
 * –ü–æ–ª—É—á–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: userId > deviceId
 */
function getOrCreateIdentifier() {
  // 1Ô∏è‚É£ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º userId
  const userId = getCurrentUserId(); // –∏–∑ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  if (userId) {
    return userId;
  }
  
  // 2Ô∏è‚É£ –ï—Å–ª–∏ –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage
  const DEVICE_ID_KEY = 'ab_test_device_id';
  let deviceId = localStorage.getItem(DEVICE_ID_KEY);
  
  if (!deviceId) {
    // 3Ô∏è‚É£ –ï—Å–ª–∏ deviceId –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π
    deviceId = 'dev_' + crypto.randomUUID();
    localStorage.setItem(DEVICE_ID_KEY, deviceId);
  }
  
  return deviceId;
}
```

### –í–∞–∂–Ω–æ!
- `deviceId` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage` –∏ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è, –Ω–∞ –±—ç–∫–µ –Ω—É–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å `deviceId` —Å `userId`
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç –Ω–∞—á–Ω—ë—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `userId`, –Ω–æ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø–µ** (–ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ —Ö–µ—à—É –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ)

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```javascript
async function registerUser(email, password) {
  const deviceId = getOrCreateIdentifier();
  
  const response = await api.register({
    email,
    password,
    device_id: deviceId  // ‚Üê –ü–µ—Ä–µ–¥–∞—ë–º deviceId –Ω–∞ –±—ç–∫
  });
  
  const userId = response.user_id;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º userId –≤ sessionStorage –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
  setCurrentUserId(userId);
  
  // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  logEvent('user_registered', {
    user_id: userId,
    device_id: deviceId,
    timestamp: new Date().toISOString()
  });
  
  return userId;
}
```

---

## üéØ –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞

### –ì–¥–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
–§—Ä–æ–Ω—Ç–µ–Ω–¥, –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è identifier

### –ê–ª–≥–æ—Ä–∏—Ç–º:

```javascript
/**
 * –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ —Ç–µ—Å—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
async function getTestVariant(testId) {
  const identifier = getOrCreateIdentifier();
  
  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ –∏–∑ –±—ç–∫–∞ (–∏–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –≤ –ø–∞–º—è—Ç–∏)
  const testConfig = await getTestConfig(testId);
  
  if (!testConfig || testConfig.status === 'inactive') {
    // –ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–æ–±—ã—á–Ω–æ control)
    return {
      test_id: testId,
      variant_id: testConfig?.variants[0]?.id || 'control',
      config: testConfig?.variants[0]?.config || {},
      status: 'inactive'
    };
  }
  
  // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞
  const variant = determineVariant(identifier, testId, testConfig.variants);
  
  return {
    test_id: testId,
    variant_id: variant.id,
    config: variant.config
  };
}

/**
 * –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
 */
function determineVariant(identifier, testId, variants) {
  const combined = identifier + '-' + testId;
  
  // DJBX33X —Ö–µ—à —Ñ—É–Ω–∫—Ü–∏—è
  let hash = 0;
  for (let i = 0; i < combined.length; i++) {
    hash = ((hash << 5) - hash) + combined.charCodeAt(i);
    hash = hash & 0xFFFFFFFF;
  }
  
  const userNumber = Math.abs(hash) % 100;
  
  // –í—ã–±–∏—Ä–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ –≤–µ—Å–∞–º
  let accumulated = 0;
  for (const variant of variants) {
    accumulated += variant.weight;
    if (userNumber < accumulated) {
      return variant;
    }
  }
  
  // –ù–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π
  return variants[variants.length - 1];
}
```

### –ö–ª—é—á–µ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ:
- –û–¥–∏–Ω `identifier` + `test_id` **–≤—Å–µ–≥–¥–∞** –¥–∞—é—Ç –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `device_id: "dev_123"` –±—ã–ª –≤ –≥—Ä—É–ø–ø–µ "experiment", —Ç–æ –∏ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `userId: "user_456"`) –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é

**–í–∞–∂–Ω–æ**: –ù–∞ –±—ç–∫–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ `device_id ‚Üí user_id`, —á—Ç–æ–±—ã –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–æ –∏ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## üéØ –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Ü–µ–Ω—ã)

### –ì–¥–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
–§—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ü–µ–Ω–æ–π

### –ê–ª–≥–æ—Ä–∏—Ç–º:

```javascript
/**
 * –í—ã—á–∏—Å–ª–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É —Å —É—á—ë—Ç–æ–º A/B —Ç–µ—Å—Ç–∞
 */
async function getFinalPrice(basePrice) {
  // 1Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ —Ç–µ—Å—Ç–∞
  const testResult = await getTestVariant('price_jan_2026_v1');
  
  // 2Ô∏è‚É£ –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
  const priceMultiplier = testResult.config.price_multy || 1.0;
  
  // 3Ô∏è‚É£ –í—ã—á–∏—Å–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
  const finalPrice = Math.round(basePrice * priceMultiplier);
  
  // 4Ô∏è‚É£ –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä —Ü–µ–Ω—ã (—Å–º. –®–∞–≥ 5)
  logEvent('price_displayed', {
    test_id: testResult.test_id,
    variant_id: testResult.variant_id,
    base_price: basePrice,
    price_multiplier: priceMultiplier,
    final_price: finalPrice
  });
  
  return finalPrice;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ HTML:
const basePrice = 299; // –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
const finalPrice = await getFinalPrice(basePrice);
document.querySelector('.price').textContent = finalPrice + ' ‚ÇΩ';
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
```javascript
// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
const productPrice = await getFinalPrice(productData.base_price);

// –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
const cartItemPrice = await getFinalPrice(item.base_price);

// –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
const orderTotal = items.reduce((sum, item) => {
  return sum + getFinalPrice(item.base_price);
}, 0);
```

---

## üéØ –®–∞–≥ 5: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –ì–¥–µ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è:
–§—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è:

```json
{
  "event_type": "price_displayed",
  "timestamp": "2026-01-26T11:22:00Z",
  "user_identifier": "dev_8f4a9b2c-1234",
  "user_id": null,
  "device_id": "dev_8f4a9b2c-1234",
  "test_assignments": {
    "price_jan_2026_v1": {
      "variant_id": "experiment",
      "price_multy": 0.5
    }
  },
  "event_data": {
    "base_price": 299,
    "final_price": 150,
    "product_id": "prod_123"
  }
}
```

### –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|-------|----------|
| `page_view` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É | URL, referrer |
| `price_displayed` | –¶–µ–Ω–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ | base_price, final_price, multiplier |
| `add_to_cart` | –ö–ª–∏–∫ "–¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" | product_id, final_price |
| `view_cart` | –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—Ä–∑–∏–Ω—ã | cart_total, item_count |
| `checkout_start` | –ù–∞—á–∞–ª–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ | cart_total |
| `order_placed` | –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω | order_id, order_total, items_count |
| `purchase_confirmed` | –û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞ | order_id, order_total |

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```javascript
/**
 * –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
 */
async function logEvent(eventType, eventData = {}) {
  const identifier = getOrCreateIdentifier();
  const userId = getCurrentUserId();
  
  // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
  const testAssignments = {};
  const activeTests = ['price_jan_2026_v1', 'shipping_test', 'ui_test'];
  
  for (const testId of activeTests) {
    const testResult = await getTestVariant(testId);
    testAssignments[testId] = {
      variant_id: testResult.variant_id,
      ...testResult.config
    };
  }
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ
  const event = {
    event_type: eventType,
    timestamp: new Date().toISOString(),
    user_identifier: identifier,
    user_id: userId || null,
    device_id: identifier.startsWith('dev_') ? identifier : null,
    test_assignments: testAssignments,
    event_data: eventData
  };
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±—ç–∫
  await fetch('/api/events/log', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(event)
  });
}

// –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
logEvent('page_view', { url: window.location.pathname });
logEvent('add_to_cart', { product_id: 'prod_123', price: 150 });
logEvent('order_placed', { order_id: 'ord_456', total: 500 });
```

### –ë—ç–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è:
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑–µ (events —Ç–∞–±–ª–∏—Ü–∞)
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ DWH –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. –°—Ç—Ä–æ–∏—Ç dashboards –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º: –∫–æ–Ω–≤–µ—Ä—Å–∏—è, AOV, CR –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º, etc

---

## üìä –®–∞–≥ 6: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–æ–≤ (Reference)

### –ú–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –º–æ–∂–µ–º —Å—á–∏—Ç–∞—Ç—å:

```sql
-- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
SELECT 
  test_assignments->>'price_jan_2026_v1' as variant,
  COUNT(DISTINCT user_identifier) as users,
  COUNTIF(event_type = 'order_placed') / COUNT(*) as conversion_rate
FROM events
WHERE test_assignments IS NOT NULL
GROUP BY variant;

-- AOV (Average Order Value) –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
SELECT
  test_assignments->>'price_jan_2026_v1' as variant,
  AVG(event_data->>'order_total'::float) as aov
FROM events
WHERE event_type = 'order_placed'
GROUP BY variant;

-- –ú–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Ü–µ–Ω—ã
SELECT
  test_assignments->>'price_jan_2026_v1' as variant,
  COUNT(*) as price_views
FROM events
WHERE event_type = 'price_displayed'
GROUP BY variant;
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê–¥–º–∏–Ω–∫–∞:
- [ ] –í–∫–ª–∞–¥–∫–∞ "–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã" —Å –ø–æ–∏—Å–∫–æ–º
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (JSON —Ä–µ–¥–∞–∫—Ç–æ—Ä)
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥–æ–≤

### –§—Ä–æ–Ω—Ç–µ–Ω–¥:
- [ ] `getOrCreateIdentifier()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ userId –∏–ª–∏ deviceId
- [ ] `getTestVariant(testId)` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] `determineVariant()` ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ö–µ—à—É
- [ ] `getFinalPrice()` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ price_multy –∫ —Ü–µ–Ω–µ
- [ ] `logEvent()` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö (–ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ä–∑–∏–Ω–∞, —á–µ–∫–∞—É—Ç)

### –ë—ç–∫:
- [ ] API `/api/experiments` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Ç–µ—Å—Ç–æ–≤
- [ ] API `/api/events/log` ‚Äî –ø—Ä–∏—ë–º —Å–æ–±—ã—Ç–∏–π –æ—Ç —Ñ—Ä–æ–Ω—Ç–∞
- [ ] –¢–∞–±–ª–∏—Ü–∞ `experiments` –≤ –ë–î (–∫–æ–Ω—Ñ–∏–≥–∏)
- [ ] –¢–∞–±–ª–∏—Ü–∞ `events` –≤ –ë–î (–ª–æ–≥–∏)
- [ ] –ú–∞–ø–ø–∏–Ω–≥ `device_id ‚Üí user_id` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å DWH –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### DWH/–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- [ ] –¢–∞–±–ª–∏—Ü–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏ (events)
- [ ] –¢–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ—Å—Ç–∞—Ö (experiments)
- [ ] Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

**–í–µ—Ä—Å–∏—è**: 3.0 (–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)
**–î–∞—Ç–∞**: 26 —è–Ω–≤–∞—Ä—è 2026
**–ê–≤—Ç–æ—Ä**: Product Manager (–Ø–Ω–¥–µ–∫—Å –î–æ—Å—Ç–∞–≤–∫–∞)